<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Smart Hat - Google Maps Navigation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Orbitron', sans-serif;
        margin: 0;
        padding: 0;
        background: #0a0a0a;
        color: #00ffc8;
      }
      #map {
        height: 60vh;
        width: 100%;
        filter: grayscale(20%) brightness(90%) contrast(120%);
      }
      #panel {
        padding: 20px;
        background: #121212;
        box-shadow: 0 0 20px rgba(0, 255, 200, 0.2);
        border-top: 2px solid #00ffc8;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        margin-bottom: 15px;
      }
      button {
        background-color: #00ffc8;
        color: #000;
        border: none;
        font-weight: bold;
        padding: 12px 24px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        box-shadow: 0 0 12px rgba(0,255,200,0.6);
        transition: transform 0.2s ease;
      }
      button:hover {
        transform: scale(1.05);
        background-color: #00e6b0;
      }
      p {
        text-align: center;
        font-size: 14px;
        color: #bbb;
      }
    </style>
    <script>
      let map, directionsService, directionsRenderer;
      let waypoints = [];
      let markerList = [];
      let voiceEnabled = true;

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 37.7749, lng: -122.4194 },
          zoom: 14,
          styles: [
            { elementType: 'geometry', stylers: [{ color: '#1d2c4d' }] },
            { elementType: 'labels.text.fill', stylers: [{ color: '#8ec3b9' }] },
            { elementType: 'labels.text.stroke', stylers: [{ color: '#1a3646' }] },
            { featureType: 'administrative', elementType: 'geometry', stylers: [{ visibility: 'off' }] },
            { featureType: 'poi', stylers: [{ visibility: 'off' }] },
            { featureType: 'road', elementType: 'geometry', stylers: [{ color: '#304a7d' }] },
            { featureType: 'water', elementType: 'geometry', stylers: [{ color: '#0e1626' }] }
          ]
        });

        directionsService = new google.maps.DirectionsService();
        directionsRenderer = new google.maps.DirectionsRenderer({ map: map });

        map.addListener("click", (e) => {
          addWaypoint(e.latLng);
        });
      }

      function addWaypoint(latlng) {
        const marker = new google.maps.Marker({ position: latlng, map: map });
        markerList.push(marker);
        waypoints.push({ location: latlng, stopover: true });
        speak(`Waypoint added at ${latlng.lat().toFixed(4)}, ${latlng.lng().toFixed(4)}`);
      }

      function clearWaypoints() {
        waypoints = [];
        markerList.forEach(m => m.setMap(null));
        markerList = [];
        directionsRenderer.set('directions', null);
      }

      function startNavigation() {
        if (waypoints.length < 2) {
          alert("Add at least two waypoints.");
          return;
        }

        const origin = waypoints[0].location;
        const destination = waypoints[waypoints.length - 1].location;
        const middle = waypoints.slice(1, waypoints.length - 1);

        directionsService.route({
          origin: origin,
          destination: destination,
          waypoints: middle,
          travelMode: google.maps.TravelMode.WALKING
        }, (result, status) => {
          if (status === "OK") {
            directionsRenderer.setDirections(result);
            const steps = result.routes[0].legs.flatMap(leg => leg.steps);
            speakInstructions(steps);
          } else {
            alert("Directions request failed due to " + status);
          }
        });
      }

      function speakInstructions(steps) {
        steps.forEach((step, i) => {
          setTimeout(() => {
            if (voiceEnabled && 'speechSynthesis' in window) {
              const msg = new SpeechSynthesisUtterance(step.instructions.replace(/<[^>]*>/g, ''));
              speechSynthesis.speak(msg);
            }
          }, i * 6000);
        });
      }

      function speak(text) {
        if (voiceEnabled && 'speechSynthesis' in window) {
          const msg = new SpeechSynthesisUtterance(text);
          speechSynthesis.speak(msg);
        }
      }

      function alertObstacle() {
        if (voiceEnabled) speak("‚ö† Obstacle ahead. Please stop.");
      }
    </script>
  </head>
  <body>
    <div id="map"></div>
    <div id="panel">
      <div class="controls">
        <button onclick="startNavigation()">üß≠ Start Navigation</button>
        <button onclick="clearWaypoints()">‚ùå Clear Route</button>
        <button onclick="alertObstacle()">üöß Simulate Obstacle</button>
      </div>
      <p>Tap the map to place waypoints. Smart Hat will guide you turn-by-turn with real-time voice assistance and obstacle detection.</p>
    </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places&callback=initMap" async defer></script>
  </body>
</html>
